-----------------------------------
-- Daily Quest : Secret Chests
-- Spawns Secret Treasure Chests in certain zones
-----------------------------------
require("modules/module_utils")
require("scripts/globals/zone")
-----------------------------------
local m = Module:new("daily_quest_secretchests")

local handleMidnight = function(player)
    local questMidnight = player:getCharVar("[DailyQuest]Midnight")
    local currentMidnight = getMidnight()

    -- handle first time quest midnight
    if questMidnight == 0 then
        player:setCharVar("[DailyQuest]Midnight",currentMidnight)
        player:setCharVar("[DailyQuest]Completed",0)
        player:setCharVar("[DailyQuest]Fishstix",0)
        player:setCharVar("[DailyQuest]Murdoc",0)
        player:setCharVar("[DailyQuest]Mistrix",0)
        player:setCharVar("[DailyQuest]Saltlik",0)
        player:setCharVar("[DailyQuest]Beetrix",0)
    end
    
    -- handle midnight reset
    if currentMidnight < questMidnight then
        player:setCharVar("[DailyQuest]Midnight",currentMidnight)
        player:setCharVar("[DailyQuest]Completed",0)
        player:setCharVar("[DailyQuest]Fishstix",0)
        player:setCharVar("[DailyQuest]Murdoc",0)
        player:setCharVar("[DailyQuest]Mistrix",0)
        player:setCharVar("[DailyQuest]Saltlik",0)
        player:setCharVar("[DailyQuest]Beetrix",0)
    end
end

local treasureCostumeID = 267
local treasurePositions =
{
    -- Zone Num | Zone Name | Zone ID | POS Locations
    {1,"West_Ronfaure",                 100,{{-29,-60,219,87},{-178,-60,317,128},{-547.2,-59.6,517.5,158},{-483.5,-46.7,226.7,8},{-236,-40,63,243},{-294.65,-32.33,-26.1,132},{-454.77,-32.33,14.25,121},{-614.63,-24.57,-151.53,242},{-521.7,0,-438.05,166},{-289.07,0.5,-521.45,97},{-181.4,0,-501.3,98},{-68.55,-0.16,-538.55,193},{-50.54,-9.5,-398.48,0}}},
    {2,"East_Ronfaure",                 101,{{220.486,0,-538.182,190},{249.895,0,-538.190,190},{289.832,0,-501.681,60},{263.351,0,-501.572,60},{330.044,0,-538.601,190},{321.404,-60,522.386,61},{420.042,-65.732,445.202,99},{498.765,-60.038,469.305,192},{507.972,-60.011,458.204,1},{767.483,-61.362,400.100,130}}},
    {3,"South_Gustaberg",               107,{{-493.839,40,-482.177,202},{-423.172,43.698,-461.885,174},{-289.327,21.262,-382.687,252},{-264.201,18.452,-313.208,84},{-191.268,17.982,-427.840,128},{-123.347,18.781,-483.586,222},{70.422,-5.777,-463.857,98},{363.695,-1.236,684.129,158},{520.142,-2.924,736.791,189}}},
    {4,"North_Gustaberg",               106,{{-589.808,40,54.876,222},{-437.971,0,479.694,0},{506.035,0.301,428.598,5},{441.289,0,405.997,43},{320.726,-2.797,329.384,58},{200.299,0.055,324.101,94},{150.093,-5.715,336.141,83},{129.516,-2.763,399.964,115},{86.767,0.459,527.733,122},{-74.624,-0.077,599.272,4}}},
    {5,"West_Sarutabaruta",             115,{{-370.861,-22.244,216.441,252},{-411.797,-17.725,327.605,1},{-258.004,-17.250,660.441,254},{-189.890,-26.054,496.843,128},{-5.394,-12.484,308.276,64},{238.214,-9.900,40.014,0},{-1.329,0,-156.606,39},{-61.796,-6.163,-250.548,191},{-121.292,-4.941,-287.890,188},{104.838,-0.931,-203.319,122}}},
    {6,"East_Sarutabaruta",             116,{{233.289,-24.662,560.574,6},{-59.756,-37.250,734.799,63},{-273.952,-22.770,662.066,255},{286.569,-2.700,261.747,255},{446.820,-2.500,298.321,127},{378.862,-13.250,99.907,128},{446.889,9.343,-139.345,255},{485.318,9.500,-140.142,121},{-246.174,-3.735,-160.158,34},{-351.037,-3.057,-130.521,117}}},
    {7,"La_Theine_Plateau",             102,{{-266.886,4.334,291.993,114},{-441.370,6.356,229.318,66},{-449.020,-8.029,293.092,135},{-607.264,0.083,474.459,100},{-561.724,0,637.696,177},{-180.001,8.820,254.831,36},{338.781,19.104,-63.751,144},{434.970,24,22.074,198},{748.774,29.002,-16.079,242},{563.891,41.371,-427.724,124}}},
    {8,"Konschtat_Highlands",           108,{{563.063,30.777,635.960,154},{458.349,31.260,464.815,152},{233.449,24,300.122,187},{142.523,19.104,223.923,93},{402.982,-1.207,-3.363,154},{-233.059,16.361,199.887,7},{-328.557,16.044,195.746,124},{-705.982,2.818,103.857,237},{-263.467,-49.471,-466.454,206},{94.111,-69.003,-577.422,119}}},
    {9,"Tahrongi_Canyon",               117,{{361.894,-8.946,-87.874,160},{200.877,-24.986,-168.091,188},{-42.281,46.931,-672.194,19},{207.646,15.117,-680.856,118},{90.488,1.173,-109.851,59},{78.790,15.712,114.882,220},{176.975,35.150,262.554,63},{117.653,40,355.244,129},{450.495,46.388,495.988,78},{-152.077,47.044,641.737,129}}},
    {10,"Valkurm_Dunes",                103,{{93.458,-2.327,-112.212,110},{124.903,-7.349,92.950,214},{325.594,-8.250,76.057,153},{368.845,-0.533,-127.749,156},{-269.074,1.901,-158.253,231},{-361.166,0.303,-12.603,10},{-306.172,-11.030,252.209,93},{-468.335,-18.286,366.880,82},{-628.852,-10.691,211.435,95},{-797.904,-6.050,51.110,220}}},
    {11,"Jugner_Forest",                104,{{243.2674,0.0000,-1.9098,162},{332.7855,-1.3893,-218.1996,152},{59.7847,0.5666,-30.2552,52},{-135.6859,0.7641,-160.2753,213},{-122.1466,-8.0000,-522.7593,251},{-62.4835,-20.8025,-659.9227,235},{-20.8877,-4.0700,302.5906,212},{92.4609,0.4849,475.6379,44},{262.9796,0.8255,555.8021,34},{562.7896,0.0971,325.9646,106}}},
    {12,"Batallia_Downs",               105,{{-684.6698,-12.2000,164.7846,30},{-516.8535,-4.2000,-38.3124,98},{-236.4650,-20.2000,-76.6095,99},{-197.8350,-4.2000,38.1056,161},{-61.5022,0.9237,439.5493,7},{-15.2355,3.8000,295.1584,31},{64.4709,-14.5332,140.3338,129},{195.0482,11.8000,-44.7756,226},{338.6655,3.3601,63.3932,149},{145.3150,11.8000,-384.2086,33}}},
    {13,"Pashhow_Marshlands",           109,{{534.9106,24.4139,693.1660,193},{470.0331,24.6623,412.1792,165},{269.0648,25.0000,415.1863,38},{53.6186,24.3043,365.3375,53},{208.8063,25.0000,148.1856,91},{458.2511,24.5071,-10.8369,136},{295.6585,25.2500,-95.0222,52},{243.6703,24.9892,-296.4225,195},{-35.0967,25.0000,-147.0363,84},{-416.9833,24.0898,-228.9177,61}}},
    {14,"Rolanberry_Fields",            110,{{-342.0245,-23.7784,-670.3920,252},{-395.1242,-8.5000,-443.1851,232},{-432.5514,-15.5754,-316.0685,6},{-632.1749,-23.6895,-271.2613,189},{-436.2982,-7.7233,17.4652,230},{-481.7202,0.0000,157.5170,251},{-202.3049,8.0000,362.4264,225},{314.3024,16.0837,321.3084,59},{520.2621,-8.0000,42.1197,85},{242.8125,-31.0329,-259.3657,131}}},
    {15,"Sauromugue_Champaign",         120,{{-129.1338,-25.1600,-400.0967,245},{-117.8947,16.2659,30.6597,61},{-268.8352,8.2690,54.3324,216},{-243.4174,8.0000,243.7835,130},{-205.8423,15.8831,283.7137,115},{-239.8076,15.0635,447.8749,87},{202.6848,31.2921,193.5551,54},{353.3181,23.8305,-3.2562,100},{366.5192,14.9162,-215.2834,184},{421.7435,16.3432,-149.5891,54}}},
    {16,"Beaucedine_Glacier",           111,{{-228.8481,-80.8019,258.8343,167},{-24.6721,-59.6147,-76.0180,63},{-176.8972,-40.2500,-219.7463,255},{99.9957,-20.2500,136.7716,65},{59.2686,-0.2500,-335.2778,191},{-87.6468,0.0165,-369.4749,222},{265.1904,-0.2500,-19.8082,2},{154.1081,-0.0958,120.1986,4},{250.4337,-0.2000,208.6171,101},{271.8987,20.0449,527.1563,89}}},
    {17,"Xarcabard",                    112,{{-139.5488,-21.3258,129.0947,62},{-103.9603,-39.8249,41.4914,155},{-255.0679,-14.9442,-147.0284,187},{-292.9190,-22.7128,147.0915,64},{-411.4244,-44.0000,32.8717,245},{119.3985,-28.7700,-123.1243,156},{57.2033,-28.5111,-193.1673,68},{-23.4988,-24.2179,-496.3124,204},{195.7353,-23.9879,-202.0951,111},{577.5774,-0.4375,-14.1310,198}}},
    {18,"Cape_Teriggan",                113,{{254.8981,2.9751,56.3916,66},{146.7516,2.3398,-195.8009,151},{-188.2556,8.0516,-69.4246,253},{-187.9107,1.5278,-303.2005,233},{-176.0762,3.0037,54.7913,9},{-275.5800,-15.7296,139.2300,15},{116.6077,0.0000,285.1415,57},{176.8529,2.9547,145.2006,134},{16.4720,-5.0054,105.3912,132}}},
    {19,"Eastern_Altepa_Desert",        114,{{225.2773,-11.3020,260.1861,196},{45.0305,-7.9499,398.5899,16},{-55.3194,3.9492,226.3541,134},{-151.4631,-7.5547,345.3339,49},{-307.2764,0.4666,116.3732,97},{-170.6364,8.3949,-170.7187,218},{-258.1786,8.4535,-252.7911,246},{25.9434,10.1992,-264.3477,147},{474.2984,-0.6997,-60.4492,147},{499.9066,2.1992,148.9513,59}}},
    {20,"Western_Altepa_Desert",        125,{{-90.0854,-2.4527,449.0002,36},{146.2338,0.5714,243.5722,186},{-151.8872,-16.7349,20.0748,253},{-145.5451,-15.0902,-12.2120,23},{-212.1482,-14.8574,-15.1000,81},{-332.7083,0.4771,-114.4276,143},{-275.5997,-4.4492,63.7249,104},{-462.1591,-0.0612,261.0957,87},{-201.1693,-2.3585,373.1492,61},{-215.4306,-11.7883,102.5631,172}}},
    {21,"Meriphataud_Mountains",        119,{{728.4697,-33.0483,40.2009,129},{688.9405,-25.1270,161.2462,141},{603.6194,-32.0000,279.9139,87},{121.6685,-8.9222,607.8154,44},{-285.2278,15.6881,600.7204,7},{-289.8122,16.3845,417.9721,100},{-528.8677,-9.1157,198.4571,252},{719.4794,-32.9382,-87.8839,193},{354.2725,-8.0052,-118.2133,172},{202.5027,0.0000,-522.2034,188}}},
    {22,"Buburimu_Peninsula",           118,{{-272.7763,18.2141,-325.9178,26},{33.2192,-0.0064,-196.1049,40},{81.4943,0.0907,-194.1635,155},{357.2985,0.0000,-240.4695,208},{442.1010,0.0000,-318.7705,194},{445.5502,18.2740,193.4318,37},{194.4682,-16.8663,245.2752,25},{-38.0914,-24.0000,279.7069,55},{-345.3481,-24.5464,50.8134,16},{-476.5060,-32.2202,47.6595,196}}},
    {23,"The_Sanctuary_of_ZiTah",       121,{{465.6945,-0.0102,-566.2515,4},{489.0155,0.1602,-278.6891,132},{606.3391,0.4293,-128.9220,77},{337.1624,-0.7646,-140.3643,169},{132.8560,-0.7000,-141.9269,151},{-35.6515,0.2126,-150.7413,193},{-432.3432,0.1817,121.5100,99},{-370.2611,-0.0354,290.9156,145},{-340.1540,0.4012,418.0867,73},{-284.5505,0.0264,523.3145,89}}},
    {24,"RoMaeve",                      122,{{-0.0487,-29.3984,82.5825,192},{-0.2824,-29.3241,60.3875,56},{182.3899,-5.0000,11.6407,96},{221.0516,-6.5400,-97.3868,186},{101.3497,-5.2000,4.1336,84},{161.1452,-6.0000,-114.5502,191},{-116.8099,-4.0708,-114.8103,223},{-95.5379,-1.0000,-83.1229,214},{-147.9766,0.9016,-108.0093,196},{-103.0063,-5.2000,2.6364,36},{-66.1635,-5.2000,23.8956,48}}},
    {25,"Yuhtunga_Jungle",              123,{{-223.5197,-0.1635,498.5134,150},{-261.2157,5.4071,454.5269,253},{-74.6055,-0.2211,445.9792,102},{-308.9467,2.6639,223.0647,1},{-417.5992,8.7174,213.2710,217},{-373.5449,13.0000,-96.8053,158},{-301.0068,4.0596,-102.7879,194},{-417.5006,10.6672,-265.7918,178},{-649.7037,-0.0129,44.0973,28},{-609.2664,0.0000,-121.4595,247}}},
    {26,"Yhoator_Jungle",               124,{{250.3906,0.1698,-532.5775,184},{277.1335,0,-399.6764,192},{215.8089,0.0787,32.6307,194},{91.3226,0,196.0168,150},{-101.8786,-1.4944,52.0368,213},{-253.4885,6.6471,28.4988,93},{-498.4855,8.8406,-188.6802,222},{-459.4060,1.5500,-331.7365,164},{-256.4169,0.0316,-458.8336,195},{1.6,0.1,-347.2178,128}}},
    {27,"Qufim_Island",                 126,{{-267.7306,-19.5779,402.3297,240},{-340.6172,-12.1026,539.2167,9},{-130.7917,-21.4513,413.4923,6},{-111.9717,-19.6915,229.8066,198},{45.2582,-20.0641,283.0483,233},{181.1417,-22.3171,135.8035,221},{167.4396,-21.9135,28.6876,167},{93.4568,-21.5034,-51.1449,32},{-35.4559,-21.7744,-53.7631,110},{173.5320,-21.9593,-28.5420,65},{96.5474,17.9617,-263.3933,19}}},
    {28,"Temple_of_Uggalepih",          159,{{76.4836,0,-39.3,191},{66.4732,1.4603,-60.2844,78},{-210.9982,0,-13.6968,105},{-132.7098,0,-67.8487,64},{-20.5119,0.5,-82.6116,0},{-27.2094,-24.9999,37.7444,96},{-27.4638,-17,-147.8486,65},{267.8488,0,112.7122,1},{347.3,-0.0009,222.8087,127},{425.5971,5.2471,223.3,64}}},
    {29,"Valley_of_Sorrows",            128,{{141.0560,-5.8524,-58.5018,92},{101.4715,-0.3392,-11.4836,199},{-57.2116,-5.0907,55.0726,5},{-104.8795,-5.0855,17.0616,80},{-176.1701,-11.4837,13.2509,120},{-130.4733,-2.4491,-25.5167,15},{-18.7014,-1.5429,-55.3335,155},{36.4795,-0.6639,49.9907,46},{106.1917,-3.9239,-49.5341,216},{99.5238,-9.0230,-103.0284,197}}},
    {30,"Bibiki_Bay",                     4,{{649.2197,-21.1735,838.9446,126},{569.2031,-19.9828,753.0187,119},{477.8183,-5,777.5853,26},{454.0760,-3.0024,729.1177,2},{241.0836,-37.1751,849.2199,63},{146.7451,-37.9250,613.5005,177},{273.1945,-20.7964,602.9559,54},{337.7320,-22.3767,330.3999,55},{335.1253,-16.1852,234.6558,22},{65.3972,-28.7474,221.8518,83},{266.7132,-0.8388,180.6371,110}}},
    {31,"Carpenters_Landing",             2,{{94.1544,0,-790.9814,23},{141.2996,-8.0359,-698.9128,21},{34.6015,-6.5839,-557.3453,146},{121.0843,-1.4081,-383.1139,157},{214.2950,-2.1647,-514.6212,2},{-195.6206,-15.2777,-566.9509,74},{-132.6079,-6.6585,-451.9542,205},{-401.6357,0,-288.0172,118},{-246.4470,-10.4654,-228.2930,45},{-225.8413,-5.4578,124.1906,210}}},
    {32,"Uleguerand_Range",               5,{{180.7980,-1.6623,-266.3570,224},{486.8345,-5.7689,-170.5013,183},{597.3609,-35.7136,110.2478,217},{378.8505,-69.6670,254.3159,187},{194.3984,-116.0813,401.5267,105},{-349.3824,-157.3457,373.4465,161},{-244.6164,-183.5350,450.3989,164},{-487.6442,-21.8272,-90.8194,192},{-610.6097,-42.0747,33.0965,187},{-124.5585,-40,-297.4514,233}}},
    {33,"Attohwa_Chasm",                  7,{{-476.7557,-5.3073,329.1645,76},{-395.6605,-4.3026,233.6366,25},{-491.1745,-4.8206,93.5350,51},{-313.9382,-4,-115.1834,35},{-241.9957,4,-121.9367,63},{150.8976,10.7240,-276.7079,17},{300.7929,20,-220.9313,107},{215.1473,19.6599,101.1930,13},{405.7065,20.0584,127.6551,223},{475.3159,19.9023,-2.4294,111},{507.9641,19.6712,-190.9994,140},{384.6779,19.6660,-221.9128,133}}},
    {34,"Oldton_Movalpolos",             11,{{-10.4422,7.9728,65.6544,89},{8.0447,8,-50.4424,17},{-75.3075,20,-88.0158,57},{-221.6054,8,-28.8232,60},{-263.2505,-0.0062,148.9118,0},{-114.7858,22.8342,-100.4284,128},{-154.5961,8,-252.4370,27},{-229.2527,11.7840,-267.1378,190},{73.0363,16,-107.9818,128},{191.3546,20,-69.1934,191}}},
    {35,"Newton_Movalpolos",             12,{{341.8169,26.0657,0.3749,254},{228.6841,16,33.2716,90},{-64.9006,12.7273,23.8257,127},{-152.3001,16.0007,-94.8652,191},{-307.0733,11.9728,-187.5821,64},{18.4422,16.7868,226.8321,182},{-183.1646,16,193.1616,63},{-96.7979,16,43.7363,127},{-23.3782,16.8373,15.8695,192},{51.1889,16,-191.3059,197}}},
    {36,"Wajaom_Woodlands",              51,{{712.7916,-15.5000,223.5268,1},{387.0656,-27.6859,30.9463,48},{108.7740,-16.6048,-182.4820,105},{-68.8220,-15.7500,-563.3460,67},{-442.4357,-15.9362,-634.9500,127},{-746.1202,-12.1665,-504.9829,23},{-580.4454,-18.3097,-186.8004,14},{-776.5496,-23.5000,125.2074,63},{-444.4756,-28.2676,427.5665,25},{-336.7426,-31.5000,676.4467,185},{197.0583,-28.2500,252.7048,74}}},
    {37,"Bhaflau_Thickets",              52,{{-64.0502,-18.4411,-630.1198,190},{-486.6855,-24.4467,-50.5360,62},{-595.5871,-3.5590,19.1493,71},{252.1351,-12.5859,167.6621,58},{583.6663,-7.8957,127.3840,62},{291.3737,-28.4495,509.0387,116},{105.9162,-35.8753,628.0790,179},{-46.6950,-36.4469,450.5360,194},{144.7336,-16.9880,367.9151,46},{-34.9598,-23.5000,136.5606,126}}},
    {38,"Arrapago_Reef",                 54,{{-469.6715,-3.5444,-495.3701,167},{-210.2438,-3.5320,-464.6281,24},{-74.5344,-7.9204,-374.6465,5},{-103.2985,-4.2688,-182.9001,114},{55.7160,-16.4418,-87.7795,247},{52.6403,-8.6325,180.5163,239},{-74.5766,-10.0483,205.4029,215},{-128.1362,-10,440.5055,95},{66.3453,-9.1715,467.1918,163},{152.2564,-7.7257,534.8816,10},{219.0674,-3.5022,267.1868,137},{404.8217,-10.0887,34.0573,248},{236.1203,-8.9707,351.3483,70},{542.7513,-13.9328,244.9393,163}}},
    {39,"Mount_Zhayolm",                 61,{{-547.6975,-14.1605,-215.0474,214},{-701.5394,-9.9064,-108.1099,21},{-560.7676,-13.6528,308.7409,199},{-295.0697,-16.1663,212.3312,225},{-27.7815,-16.1420,134.9503,28},{95.2751,-18.1956,149.6865,2},{245.2578,-32,33.7430,200},{379.5495,-32,71.2807,124},{663.1000,-27,333.6458,0},{907.7633,-16.1523,335.0270,70},{768.7491,-14.2841,12.2236,78},{427.7138,-16.1565,-224.9781,94},{103.7725,-16.1898,-100.6816,78}}},
    {40,"Halvung",                       62,{{205.6580,-6.0681,150.5163,199},{56.7985,-13.6049,261.3592,210},{-39.6444,9.7610,307.0240,249},{346.8824,-0.1725,308.6879,87},{429.6626,-0.2196,107.3776,97},{114.3881,13.9184,49.5346,77},{64.8308,-0.4264,-247.3707,79},{-30.8628,9.8143,-273.1687,234},{15.0121,7.8585,-395.0004,3},{-221.6034,19.7500,-168.6798,64},{-334.8384,19.7086,131.6238,192}}},
    {41,"Mamook",                        65,{{-153.4018,14.4886,-141.5767,93},{-237.2765,14.7534,-84.7889,4},{-131.0357,10.0441,-107.3815,203},{126.8682,-4.0122,-61.1005,90},{73.4568,14.5539,-258.1375,220},{261.2603,16.4031,-180.4453,92},{345.0163,-7.6214,-249.7541,144},{286.2139,11.0540,-420.1168,126},{22.1100,18.1843,-405.7432,182},{-219.0995,19.4032,-421.5558,217}}},
    {42,"Aydeewa_Subterrane",            68,{{336.7431,35.3734,-10.7546,8},{264.5390,33.0990,-178.7696,148},{95.1916,33.1860,-178.0741,248},{85.8564,33.1017,-219.4400,119},{-145.6629,12.3779,-499.4544,240},{-101.1248,8.6465,-247.7591,19},{-414.9314,13.7228,-453.4945,249},{-389.2336,14.2274,-307.5736,99},{-349.6526,7.9261,-218.1423,169},{-324.4470,-7.4380,-246.5837,90},{-326.9941,36.6386,-132.2034,86}}},
    {43,"Alzadaal_Undersea_Ruins",       72,{{83.6345,0,157.3002,62},{2.6999,-4,43.5929,255},{-196.3704,-8,-37.2999,192},{-57.8000,-4.4000,-142.0534,1},{482.6999,0,443.5392,255},{682.7003,0,436.2940,1},{337.7999,-0.4000,617.8787,127},{517.3001,0,-163.6280,127},{402.7001,-0.4000,-573.2168,0},{-19.9723,-4.4000,235.2881,65}}},
    {44,"Caedarva_Mire",                 79,{{172.7489,-4.6598,-750.5190,171},{248.7499,-4.6782,-648.2476,55},{173.0958,-12.6619,-430.3198,175},{307.7208,-15.8634,-325.7191,68},{546.1207,-20.3160,-314.2608,122},{509.2331,-24.7533,-58.8106,217},{506.5172,-30.1055,111.1895,100},{179.4053,-17.0561,-48.6642,66},{125.6690,-7.8389,-186.9813,244},{-292.3069,4.2908,-448.6812,54},{-406.9695,8.1837,-558.8198,198},{-306.1786,-4.2500,-747.4673,172},{-452.2873,-7.7089,-88.6871,52},{-632.0689,10.3400,-189.9703,231},{-707.4146,-16.6625,350.6420,85},{-806.0107,-19.8588,658.3561,49}}},
    {45,"Yughott_Grotto",               142,{{406.8389,-40.0621,153.7282,204},{345.8037,-40.3372,188.8921,138},{422.7217,-40.0391,67.4153,246},{350.7582,-40.3536,85.7197,69},{313.6848,-39.7874,154.4831,134},{313.6602,-23.7796,165.6070,231},{336.9407,-23.9687,252.1086,127},{110.4359,-12.8959,109.9284,147},{-14.2609,-0.3245,-61.5101,67},{-114.3103,0.1478,-29.8941,131},{-204.5477,-0.9373,-118.8511,179}}},
    {46,"Fort_Ghelsba",                 141,{{184.2812,-86.3594,17.3266,60},{126.6502,-60,-20.9796,39},{8.7021,-48,0.8855,99},{151.9822,-32.0603,172.3534,215},{-67.7530,-24,127.8998,126},{-21.2281,-20,-119.4283,64},{-21.1648,-28,-60.8699,112},{21.7144,-52,-79.5667,84},{143.4167,-45.5840,-114.4458,179},{-67.7130,-24,8.0813,127}}},
    {47,"Palborough_Mines",             143,{{90.7779,-32,-69.3000,192},{27.2804,-32.3231,-91.9886,106},{20.7538,-31.8550,81.0149,180},{111.7792,-32,58.7041,190},{266.6291,-32.2355,188.1947,88},{251.9413,-32.3306,-52.7297,39},{211.5083,-32.1733,-54.0068,24},{176.8038,-36.4081,-59.6943,215},{287.1752,-16.1999,104.2349,236},{259.5063,-16.3441,230.3738,62},{-46.5366,-15.5103,219.9616,190},{200.9813,-0.6052,97.6505,173},{167.2410,-15.2185,30.7395,19}}},
    {48,"Giddeus",                      145,{{-254.1483,-2.3445,-267.5351,180},{-146.6053,0.8244,-225.4620,99},{-84.3711,0.8568,-146.0622,126},{-104.6367,0,162.0070,134},{-174.3399,5,336.4589,41},{-58.2249,3.8455,312.9622,24},{-56.8746,0.6550,177.2354,25},{-146.9191,16.7600,51.4309,231},{-69.0319,16.7477,93.2061,222},{62.5438,0.9736,-224.1075,67},{224.8490,-3.0182,-287.7898,92},{-8.4942,0.4513,-425.0740,68}}},
    {49,"Beadeaux",                     147,{{371.7138,23.2631,49.5229,218},{380.0883,23.8897,146.8442,190},{186.8813,39.3319,29.0127,88},{-214.1564,23.7232,90.9070,160},{-227.2785,-2.8660,138.4095,171},{-246.3223,-3.0228,56.3356,128},{-281.4202,-3.2500,-242.1554,56},{-39.0060,-3.2500,-79.3917,75},{23.3425,-2.9741,81.6847,193},{283.0561,-3.2500,118.1628,23},{58.0839,1,4.2436,183},{-53.7995,0.8992,-185.2127,96}}},
    {50,"Davoi",                        149,{{309.6557,0.7500,-27.2965,172},{336.8633,-0.3127,-241.4209,243},{142.8628,2.8092,-217.0146,97},{97.2068,-5.1509,-163.2906,78},{-28.6921,4,-240.6752,21},{-152.3295,3.9513,-226.2940,126},{-223.4417,2.8479,-297.3326,84},{-272.2968,3.7411,-61.2071,17},{-227.6305,-0.2060,61.7344,16},{-133.5475,4.0493,22.3536,146},{170.0060,1.3697,-27.8083,166},{309.6668,0.7500,-27.3666,145}}},
    {51,"Monastic_Cavern",              150,{}},
    {52,"Castle_Oztroja",               151,{}},
    {53,"The_Boyahda_Tree",             153,{}},
    {54,"Lower_Delkfutts_Tower",        184,{}},
    {55,"Middle_Delkfutts_Tower",       157,{}},
    {56,"Upper_Delkfutts_Tower",        158,{}},
    {57,"Den_of_Rancor",                160,{}},
    {58,"Castle_Zvahl_Baileys",         161,{}},
    {59,"Castle_Zvahl_Keep",            162,{}},
    {60,"Ranguemont_Pass",              166,{}},
    {61,"Bostaunieux_Oubliette",        167,{}},
    {62,"Toraimarai_Canal",             169,{}},
    {63,"Zeruhn_Mines",                 172,{}},
    {64,"Korroloka_Tunnel",             173,{}},
    {65,"Kuftal_Tunnel",                174,{}},
    {66,"The_Eldieme_Necropolis",       195,{}},
    {67,"Sea_Serpent_Grotto",           176,{}},
    {68,"Dangruf_Wadi",                 191,{}},
    {69,"Inner_Horutoto_Ruins",         192,{}},
    {70,"Outer_Horutoto_Ruins",         194,{}},
    {71,"Ordelles_Caves",               193,{}},
    {72,"Gusgen_Mines",                 196,{}},
    {73,"Crawlers_Nest",                197,{}},
    {74,"Maze_of_Shakhrami",            198,{}},
    {75,"Garlaige_Citadel",             200,{}},
    {76,"FeiYin",                       204,{}},
    {77,"Ifrits_Cauldron",              205,{}},
    {78,"Quicksand_Caves",              208,{}},
    {79,"Gustav_Tunnel",                212,{}},
    {80,"Labyrinth_of_Onzozo",          213,{}},
    {81,"Dynamis-Bastok",               186,{}},
    {82,"Dynamis-San_dOria",            185,{}},
    {83,"Dynamis-Windurst",             187,{}},
    {84,"Dynamis-Jeuno",                188,{}},
    {85,"Dynamis-Beaucedine",           134,{}},
    {86,"Dynamis-Xarcabard",            135,{}},
    {87,"RuAun_Gardens",                130,{}},
    {88,"VeLugannon_Palace",            177,{}},
    {89,"The_Shrine_of_RuAvitau",       178,{}},
    {90,"AlTaieu",                       33,{}},
    {91,"Grand_Palace_of_HuXzoi",        34,{}},
    {92,"The_Garden_of_RuHmet",          35,{}},
    {93,"Lufaise_Meadows",               24,{}},
    {94,"Misareaux_Coast",               25,{}},
    {95,"Phomiuna_Aqueducts",            27,{}},
    {96,"Sacrarium",                     28,{}},
    {97,"Riverne_Site-A01",              30,{}},
    {98,"Riverne_Site-B01",              29,{}},
    {99,"Escha-ZiTah",                  288,{}},
    {100,"Escha-RuAun",                 289,{}}
}

for _, entry in pairs(treasurePositions) do
    local questZoneNum         = entry[1]
    local questZoneName        = entry[2]
    local questZoneID          = entry[3]
    local positionsLength      = #(entry[4])
    local randChestNum = math.random(1,positionsLength)
    local positionX = entry[4][randChestNum][1]
    local positionY = entry[4][randChestNum][2]
    local positionZ = entry[4][randChestNum][3]
    local positionR = entry[4][randChestNum][4]

    m:addOverride(string.format("xi.zones.%s.Zone.onInitialize",questZoneName), function(zone)

        super(zone)

        local dailyQuestChest = zone:insertDynamicEntity({

            objtype = xi.objType.NPC,
            name = "Secret Chest",
            look = treasureCostumeID,
            x = positionX,
            y = positionY,
            z = positionZ,
            rotation = positionR,
            widescan = 0,

            onTrade = function(player, npc, trade)
                player:PrintToPlayer("I don't require any items from you.", 0, npc:getPacketName())
            end,
    
            onTrigger = function(player, npc)
                handleMidnight(player)
                local dailyQuestActive = player:getCharVar("[DailyQuest]Fishstix")
                local dailyQuestZone = player:getCharVar("[DailyQuest]Fishstix_zone")
                local chestOpened = npc:getLocalVar("opened")

                if dailyQuestActive == 1 and dailyQuestZone == questZoneNum and chestOpened == 0 then
                    npc:setLocalVar("opened", 1)
                    player:setCharVar("[DailyQuest]Fishstix",2)
                    player:PrintToPlayer("You found the Secret Treasure Chest, please return to Fishstix to claim your reward!", 17)
                    npc:setAnimation(1)
                    npc:timer(3, function(npc)
                        npc:setStatus(xi.status.DISAPPEAR)
                        repeat
                            randChestNum = math.random(1,positionsLength)
                            newX = entry[4][randChestNum][1]
                            newY = entry[4][randChestNum][2]
                            newZ = entry[4][randChestNum][3]
                            newRot = entry[4][randChestNum][4]
                        until(math.abs(newX - npc:getXPos()) > 1 and math.abs(newZ - npc:getZPos()) > 1)
                        npc:setPos(newX, newY, newZ, newRot)
                        npc:setAnimation(0)
                        npc:setStatus(xi.status.NORMAL)
                        npc:setLocalVar("opened", 0)
                    end)
                else
                    player:PrintToPlayer("This is not for you.", 0, npc:getPacketName())    
                end
            end,
        })

        utils.unused(dailyQuestChest)
    end)
end

return m
